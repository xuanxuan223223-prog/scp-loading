<index.html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>SCP Secure Access</title>
    <style>
        body {
            background-color: #050505;
            color: #00ff00;
            font-family: "Courier New", Courier, monospace;
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }

        /* 点击遮罩层 (默认隐藏，只有自动播放失败时才显示) */
        #click-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 100;
            display: none; /* 默认隐藏 */
            justify-content: center;
            align-items: center;
            flex-direction: column;
            cursor: pointer;
        }
        .blink-text {
            font-size: 2em;
            font-weight: bold;
            letter-spacing: 2px;
            animation: blinker 1s linear infinite;
            border: 2px solid #00ff00;
            padding: 20px;
            color: #00ff00;
            background: rgba(0, 50, 0, 0.5);
        }

        @keyframes blinker { 50% { opacity: 0; } }

        /* 样式保持不变 */
        .glitch-wrapper { position: relative; margin-bottom: 20px; }
        h1 { font-size: 5em; margin: 0; letter-spacing: 5px; position: relative; color: #00ff00; }
        h1::before, h1::after { content: "SCP FOUNDATION"; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #050505; }
        h1::before { color: #ff0000; animation: glitch-anim-1 2s infinite linear alternate-reverse; clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%); transform: translate(-2px); opacity: 0.7; z-index: -1; }
        h1::after { color: #0000ff; animation: glitch-anim-2 2s infinite linear alternate-reverse; clip-path: polygon(0 60%, 100% 60%, 100% 100%, 0 100%); transform: translate(2px); opacity: 0.7; z-index: -2; }
        @keyframes glitch-anim-1 { 0% { clip-path: polygon(0 2%, 100% 2%, 100% 5%, 0 5%); } 100% { clip-path: polygon(0 44%, 100% 44%, 100% 44%, 0 44%); } }
        @keyframes glitch-anim-2 { 0% { clip-path: polygon(0 12%, 100% 12%, 100% 12%, 0 12%); } 100% { clip-path: polygon(0 90%, 100% 90%, 100% 90%, 0 90%); } }
        
        .scanlines { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; pointer-events: none; z-index: 10; }
        .vignette { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: radial-gradient(circle, rgba(0,0,0,0) 60%, rgba(0,0,0,0.9) 100%); pointer-events: none; z-index: 20; }
        
        .container { display: flex; flex-direction: column; align-items: center; width: 80%; z-index: 5; margin-left: 120px; }
        .loading-box { border: 2px solid #00ff00; width: 100%; height: 20px; margin: 30px 0; padding: 2px; }
        .loading-bar { background-color: #00ff00; height: 100%; width: 0%; box-shadow: 0 0 10px #00ff00; transition: width 0.1s linear; }
        .console-log { width: 100%; height: 150px; font-size: 14px; overflow: hidden; text-align: left; border-top: 1px dashed #005500; padding-top: 10px; display: flex; flex-direction: column-reverse; opacity: 0.8; }
        .log-entry { margin-bottom: 4px; }
        .log-highlight { color: #ccffcc; font-weight: bold; text-shadow: 0 0 5px #00ff00; }
        .corner-info { position: absolute; font-size: 12px; color: #00aa00; z-index: 5; }
        .top-left { top: 20px; left: 20px; }
        .bottom-right { bottom: 20px; right: 20px; text-align: right; }
    </style>
</head>
<body>

    <audio id="bgm" loop preload="auto">
        <source src="bgm.ogg" type="audio/ogg">
        <source src="bgm.mp3" type="audio/mpeg">
    </audio>

    <div id="click-overlay" onclick="activateSystem()">
        <div class="blink-text">
            [ SYSTEM OFFLINE ]<br>
            <span style="font-size:0.5em; font-weight:normal;">CLICK TERMINAL TO INITIALIZE AUDIO SUBSYSTEM</span>
        </div>
    </div>

    <div class="scanlines"></div>
    <div class="vignette"></div>

    <div class="corner-info top-left">
        SECURE TERMINAL UPLINK<br>
        PROTOCOL: OMEGA-7<br>
        USER: <span id="steam-id">DETECTING...</span>
    </div>

    <div class="container">
        <div class="glitch-wrapper">
            <h1>SCP FOUNDATION</h1>
        </div>
        <h3 style="letter-spacing: 3px;">SECURE. CONTAIN. PROTECT.</h3>

        <div class="loading-box">
            <div class="loading-bar" id="loadbar"></div>
        </div>

        <div class="console-log" id="console"></div>
    </div>

    <div class="corner-info bottom-right">
        DESTINATION: <span id="map-name">UNKNOWN SECTOR</span><br>
        SYSTEM ID: SITE-09
    </div>

    <script>
        var audio = document.getElementById("bgm");
        var consoleDiv = document.getElementById("console");
        var progress = 0;
        var hasStarted = false;

        // === 1. 尝试自动播放 ===
        window.addEventListener('load', function() {
            audio.volume = 0.5;
            var promise = audio.play();
            
            if (promise !== undefined) {
                promise.then(_ => {
                    // 自动播放成功！直接开始动画
                    console.log("Autoplay success");
                    startAnimation();
                }).catch(error => {
                    // 自动播放失败 (被拦截)，显示遮罩层求点击
                    console.log("Autoplay blocked. Showing overlay.");
                    document.getElementById("click-overlay").style.display = "flex";
                });
            }
        });

        // === 2. 手动激活 (点击遮罩) ===
        function activateSystem() {
            if(hasStarted) return;
            audio.play();
            document.getElementById("click-overlay").style.opacity = "0";
            setTimeout(() => { 
                document.getElementById("click-overlay").style.display = "none"; 
            }, 500);
            startAnimation();
        }

        // === 3. 动画逻辑 ===
        function startAnimation() {
            if(hasStarted) return;
            hasStarted = true;
            addLog("SYSTEM BOOT SEQUENCE INITIATED.");
            setInterval(updateProgress, 100);
        }

        // === 4. 获取信息 ===
        function getParam(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
            var results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }
        var steamID = getParam("steamid");
        var mapName = getParam("mapname");
        if(steamID) document.getElementById("steam-id").innerText = steamID;
        else document.getElementById("steam-id").innerText = "UNAUTHORIZED USER";
        if(mapName) document.getElementById("map-name").innerText = mapName.toUpperCase();
        else document.getElementById("map-name").innerText = "CLASSIFIED SECTOR";

        // === 5. 进度条逻辑 ===
        var fakeFiles = [
            "ACCESSING SCiPNET DATABASE...",
            "VERIFYING BIOMETRICS...",
            "LOADING ASSET: SCP-173_MODEL.mdl",
            "LOADING ASSET: MTF_VOICE_PACK.wav",
            "DECRYPTING O5 COUNCIL ORDERS...",
            "CHECKING CONTAINMENT INTEGRITY...",
            "SYNCING WITH SITE-09 SERVER...",
            "LOADING ASSET: KEYCARD_TEXTURES.vtf",
            "WARNING: MEMETIC AGENT DETECTED.",
            "APPLYING COGNITOHAZARD FILTERS...",
            "LOADING ASSET: DOOR_SECURITY_SCRIPT.lua",
            "ESTABLISHING SECURE CONNECTION...",
            "LOADING: SCP-682_ADAPTATION_LOGS.txt",
            "LOADING: CLASS_D_TERMINATION_PROTOCOL.pdf"
        ];

        function addLog(text) {
            var entry = document.createElement("div");
            entry.className = "log-entry";
            if(Math.random() > 0.7) entry.className += " log-highlight";
            entry.innerText = "> " + text;
            consoleDiv.prepend(entry);
            if(consoleDiv.children.length > 8) consoleDiv.removeChild(consoleDiv.lastChild);
        }

        function updateProgress() {
            progress += Math.random() * 1.5;
            if (progress < 100) {
                document.getElementById('loadbar').style.width = progress + '%';
                if(Math.random() > 0.6) {
                    var randomFile = fakeFiles[Math.floor(Math.random() * fakeFiles.length)];
                    addLog(randomFile);
                }
            } else {
                document.getElementById('loadbar').style.width = '100%';
                if(document.getElementById('loadbar').style.backgroundColor != 'white') {
                    addLog("DOWNLOAD COMPLETE. AWAITING SERVER RESPONSE...");
                    document.getElementById('loadbar').style.backgroundColor = 'white';
                }
                if (progress > 120) {
                    progress = 0;
                    document.getElementById('loadbar').style.backgroundColor = '#00ff00';
                    addLog("RE-CALIBRATING SYSTEM...");
                }
            }
        }

        function GameDetails() {}
        function SetStatusChanged() {}
        function DownloadingFile() {}
        function SetFilesTotal() {}
        function SetFilesNeeded() {}
    </script>
</body>
</html>
